<admintpl file="header" />
<style type="text/css">
    .pagination{float: right;margin-right: 20px;}
    .pagination a, .pagination span{padding: 3px 10px;margin-left: 3px;border-radius: 3px;}
    .pagination a{background-color: #dadada;border: 1px solid #d1d1d1;color: black;text-decoration: none;}
    .pagination span{background-color: orangered;border: 1px solid orangered;color: white;cursor: default;}
</style>
</head>
<body>
<div class="wrap js-check-wrap">
    <ul class="nav nav-tabs">
        <li class="active"><a href="<?php echo U('agentlist'); ?>">发卡记录</a></li>
    </ul>

    <!-- 搜索 start by LEE  -->
    <form class="well form-search" method="post" action="<?php echo U('Admin/Grade/sendCardRecord',['id'=>$user['id']]); ?>">
        <p style="float: right;">操作用户名称：<img src="{$user['user_img']}" alt="{$user['user_img']}" style="height: 40px;" /><span style="margin-left: 10px;font-size: 16px;">{$user['nickname']}</span></p>
        发卡日期：
        <input type="text" name="keyword" style="width: 200px;" value="" placeholder="暂无处理" disabled="disabled">
        <!--<input type="submit" id="selectUser" class="btn btn-primary" value="搜索">-->
    </form>



    <table class="table table-hover table-bordered">
        <thead>
        <tr>
            <th>ID</th>

            <th style="text-align:center;">开始卡号</th>
            <th style="text-align:center;">结束卡号</th>
            <th style="text-align:center;">拿卡价格/张</th>
            <th style="text-align:center;">总数</th>
            <th style="text-align:center;">拿卡类型</th>
            <th style="text-align:center;">发卡时间</th>
            <th style="text-align:center;">当前状态</th>
            <th style="text-align:center;">操作</th>
        </tr>
        </thead>
        <tbody>
        <volist name="data" id="val">
            <tr>
                <td style="width:40px;text-align:center;">
                    {$val['id']}
                </td>

                <td style="text-align:center;">
                    {$val['start_card_no']}
                </td>
                <td style="text-align:center;">
                    {$val['end_card_no']}
                </td>
                <td style="text-align:center;">
                    <span style="font-size: 20px;color: red;font-weight: bold;">{$val['each_price']}</span>元
                </td>
                <td style="text-align:center;">
                    <span style="font-size: 20px;color: red;font-weight: bold;">{$val['card_no_num']}</span>张
                </td>
                <td style="text-align:center;">
                    <if condition="$val['card_mode'] eq '1'">
                        <span style="font-size: 14px;color: #00FF00;font-weight: bold;">正常</span>
                        <else/>
                        <span style="font-size: 14px;color: red;font-weight: bold;">赊账</span>
                    </if>
                </td>
                <td style="text-align:center;">
                    {$val['createtime']}
                </td>
                <td style="text-align:center;">
                    <if condition="$val['status'] eq '1'">
                        未发货
                        <else/>
                        已发货
                    </if>
                </td>
                <th style="text-align:center;">
                    <if condition="$val['card_mode'] eq '1'">
                        <button style="border:0; width: 70px; height: 40px;" disabled="disabled"><span style="color: white; font-size: 8px;">操作完成</span></button>
                        <else/>
                        <button style="background: #1dccaa;border:0; width: 70px; height: 40px;" id="Repayment" data-id="{$val['id']}"><span style="color: white; font-size: 8px;">清账</span></button>
                    </if>
                </th>
            </tr>
        </volist>
        </tbody>
    </table>
    <if condition="$page neq ''">
        <div id="page" class="pagination"><span class="page"><?php echo $page; ?></span></div>
    </if>
</div>
<script src="__PUBLIC__/js/common.js"></script>
<script>
    $(function(){
        $("#Repayment").click(function(){
            $(this).attr('disabled','disabled');
            var user_id="<?php echo $user['id'];?>";
            var openid = "<?php echo $user['openid'];?>";
            var id=$(this).attr('data-id');
            layer.confirm('确定还账吗？该操作不可逆转，请谨慎操作', {
                btn: ['确定','取消'] //按钮
            }, function(){
                $.ajax({
                    type:'POST',
                    url:"{:U('Grade/Repayment')}",
                    data:{id:id,user_id:user_id,openid:openid},
                    success:function(response){
                        response=$.parseJSON(response);
                        if(response.status == 200){
                            layer.msg(response.msg,{icon:1,time:3000},function(){
                                window.location.reload();
                            })
                        }else{
                            layer.msg(response.msg,{icon:2,time:3000},function(){
                                window.location.reload();
                            })
                        }
                    }
                });
            }, function(){
                $('#Repayment').removeAttr('disabled');
                layer.msg('操作取消',{icon:1});
            });

        })
    })
</script>
</body>
</html>
