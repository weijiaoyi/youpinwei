<admintpl file="header" />
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
        <style type="text/css">
            body, html{width: 100%;height: 100%;margin:0;font-family:"微软雅黑";font-size:14px;}
            #l-map{height:300px;width:100%;}
            #r-result{width:100%;}
           #error{
               color: red;
               font-size: 16px;
               margin-left:400px;
               display: none;
           }
            .true{
                color: red;
            }
        </style>
        <title></title>
    </head>
<body>
<!-- <form action="" enctype="multipart/form-data" method=""> -->
<div class="wrap js-check-wrap">
    <ul class="nav nav-tabs">
        <li class="active"><a href="<?php echo U('sendCard'); ?>">发卡</a></li>
    </ul>

    <div class="row-fluid">
        <div class="span9">
            <table class="table table-bordered">
                <tr>
                    <th>代理商名称：</th>
                    <td style="font-size: 16px;line-height: 39px;">
                        <span>{$user['nickname']}&nbsp;&nbsp;&nbsp;&nbsp;<img src="{$user['user_img']}" alt="{$user['user_img']}" style="height: 39px;" /></span>
                        <!--<input type="text" name="nickname" class="nickname" value="" style="width:150px" disabled="disabled" placeholder="请输入代理商名称">-->
                        <!--<input type="button" value="搜索" style="width:60px;height: 36px; margin-bottom:10px;" class="server-keyword">-->
                    </td>
                </tr>
                <tr>
                    <th>开始卡号：</th>
                    <td style="font-size: 16px;line-height: 39px;">
                        <span>{$data['card_no']}</span>
                        <!--<input type="text" name="start_card" id="start_card" value="<?php echo $data['card_no'];?>"  disabled="disabled"  placeholder="开始卡号">-->
                    </td>
                </tr>
                <tr>
                    <th>结尾卡号<span class="true">*</span>：</th>
                    <td>
                        <input type="text" name="end_card" id="end_card"  placeholder="请输入结束卡号">
                    </td>
                </tr>
                <tr>
                    <th>拿卡状态<span class="true">*</span>：</th>
                    <td>
                        <select name='mode' class="mode">
                            <option selected="selected">请选择</option>
                            <option value="1" >正常</option>
                            <option value="2" >赊账</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <th>拿卡价格<span class="true">*</span>：</th>
                    <td>
                        <input type="text" name="each_price" class="each_price" placeholder="请输入拿卡价格">
                    </td>
                </tr>

                <tr>
                    <th>送货地址<span class="true">*</span>：</th>
                    <td>
                        <textarea style="width:300px;" id="address" name="address"  placeholder="送货地址"></textarea>
                    </td>
                </tr>
                <tr>
                    <th>联系人<span class="true">*</span>：</th>
                    <td>
                        <input type="text" name="tel_name" id="detail"   placeholder="联系人">
                    </td>
                </tr>
                <tr>
                    <th>联系电话<span class="true">*</span>：</th>
                    <td>
                        <input type="text" name="tel" id="peopel"   placeholder="联系电话">
                    </td>
                </tr>
            </table>
        </div>
    </div>
    <p id="error"></p>
    <div class="form-actions" >
        <button style="margin-left:400px;" class="btn btn-primary js-ajax-submit" id="sendCard" type="submit">确认发卡</button>
        <a class="btn" href="javascript:history.go(-1);">返回</a>
    </div>
</div>

<!-- 成败获成功显示 -->
<div class="mengban" style="position: fixed;width:100%;height: 100%;background: #337ab7;opacity: 0.5;display: none"></div>
<div class="alert" style="width:200px;height: 110px;background: white;position: absolute;top:50%;left: 50%;margin-top: -80px;margin-left:-300px;display:none;line-height: 80px;text-align: center;font-size:20px;color: #000"></div>
<!-- </form> -->
<script type="text/javascript" src="__PUBLIC__/js/common.js"></script>
<script type="text/javascript" src="__PUBLIC__/js/jquery.min.js"></script>
<script>
    /** 给代理商发卡(确认发卡) */
    $(document).on('click','#sendCard',function(){
        var start_card = "<?php echo $data['card_no'] ?>";
        var openid = "<?php echo $data['openid'] ?>";
        var user_id = "<?php echo $data['uid'] ?>";
        var end_card = $('#end_card').val();
        var mode = $('.mode').val();
        var each_price = $('.each_price').val();
        var address = $('#address').val();
        var name = $('#detail').val();
        var phone = $('#peopel').val();
        if(end_card == '' || mode == '' || each_price == '' || address == '' || name == '' || phone == ''){
            $('#error').html('错误提示：请补全完整的信息内容！！！');
            $('#error').show();
        }else{
            $('#error').html('');
            $('#error').hide();
        }
        $.ajax({
            url:"{:U('confirmSendCard')}",
            type:'post',
            data:{start:start_card,end:end_card,each_price:each_price,mode:mode,address:address,name:name,phone:phone,openid:openid,user_id:user_id},
            success:function (res) {
                let rel=eval('('+res+')');
                if(rel.msg == 'success'){
                    $('.alert').text('添加成功');
                    $('.alert').show().delay (1000).fadeOut();
                    $('.alert').show().delay (1000).fadeOut();
                }else{
                    $('.alert').text('添加失败喽');
                }
            }
        })
    });


    $("#uploadImage").on("change", function(){
        // Get a reference to the fileList
        var files = !!this.files ? this.files : [];

        // If no files were selected, or no FileReader support, return
        if (!files.length || !window.FileReader) return;

        // Only proceed if the selected file is an image
        if (/^image/.test( files[0].type)){

            // Create a new instance of the FileReader
            var reader = new FileReader();

            // Read the local file as a DataURL
            reader.readAsDataURL(files[0]);

            // When loaded, set image data as background of div
            reader.onloadend = function(){
                $("#image").attr('src',this.result);
            }
        }

    });
    $("#prev_lev").on('change',function () {
        var lev = $("#prev_lev option:selected").val();
        $.ajax({
            url:"{:U('Admin/grade/ajaxGetPrev')}",
            type:'POST',
            data:{lev:lev},
            success:function (res) {
                if(res.data)
                {
                    var data = res.data;
                    var str = '';
                    for(var i=0;i<data.length;i++)
                    {
                        str += '<option value="'+data[i].id+'">'+data[i].grade_name+'</option>'
                    }
                    $("#prev_name").html(str);
                }else {
                    $("#prev_name").html('<option value="0">无</option>');
                }
            }
        })
    });
</script>
</body>
</html>